exports.id=4853,exports.ids=[4853],exports.modules={48152:(a,b,c)=>{"use strict";c.d(b,{Ne:()=>n,UU:()=>j,V2:()=>q,bE:()=>p,d$:()=>m,dt:()=>r,fS:()=>s,je:()=>o,ju:()=>i,p:()=>t,th:()=>k,zw:()=>h});var d=c(4410),e=c(86802);function f(a){return a.includes("supabase.co/storage/v1/object/public/wines/")?a.replace("/object/public/wines/","/object/public/Public/wines/"):a}function g(a){let b=a.toLowerCase();return b.includes("magnaneraie")?"/images/wine-magnaneraie.svg":b.includes("ros\xe9")||b.includes("rose")?"/images/wine-bottle-rose.svg":b.includes("blanc")||b.includes("white")?"/images/wine-bottle-white.svg":b.includes("rouge")||b.includes("red")?"/images/wine-bottle-red.svg":"/images/default-wine.svg"}let h=async()=>{let a=await (0,e.UL)();return(0,d.createServerClient)("https://vmtudbupajnjyauvqnej.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZtdHVkYnVwYWpuanlhdXZxbmVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5MzkwNTcsImV4cCI6MjA3MzUxNTA1N30.7SZ6RUgXQdI-nf1Dun7XnQ2sRIL-R_KcV2EoECuXsGs",{cookies:{get:b=>a.get(b)?.value,set(b,c,d){a.set(b,c,d)},remove(b,c){a.delete(b)}}})},i=a=>(0,d.createServerClient)("https://vmtudbupajnjyauvqnej.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZtdHVkYnVwYWpuanlhdXZxbmVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5MzkwNTcsImV4cCI6MjA3MzUxNTA1N30.7SZ6RUgXQdI-nf1Dun7XnQ2sRIL-R_KcV2EoECuXsGs",{cookies:{get:b=>a?.cookies.get(b)?.value,set(a,b,c){},remove(a,b){}}}),j=h,k=async()=>{let a=await h(),{data:{user:b},error:c}=await a.auth.getUser();return c?(console.error("Error getting server user:",c),null):b},l=async a=>{let b=await h(),{data:c,error:d}=await a(b);if(d){if(console.error("Database query error:",d),"PGRST116"===d.code)throw Error("Resource not found");if("42501"===d.code)throw Error("Access denied");throw Error(d.message||"Database query failed")}return c},m=async a=>l(async b=>{let c=b.from("wine_products").select(`
        *,
        product_images(
          url,
          alt_text_en,
          alt_text_fr,
          is_primary,
          display_order
        )
      `).eq("is_active",!0);return a?.category&&(c=c.eq("category",a.category)),a?.inStock&&(c=c.gt("stock_quantity",0)),a?.featured&&(c=c.eq("featured",!0)),a?.limit&&(c=c.limit(a.limit)),a?.offset&&(c=c.range(a.offset,a.offset+(a.limit||10)-1)),c.order("created_at",{ascending:!1})}),n=async(a=6)=>{try{return(await m({featured:!0,limit:a,inStock:!0})).map(a=>({...a,description:a.description_en||a.description_fr||"Fine wine from Domaine Vallot",grape_variety:a.varietal,producer:"Domaine Vallot",alcohol_content:a.alcohol_content||13.5,price_display:a.price_eur?a.price_eur.toString():"0.00",price:a.price_eur?Math.round(100*parseFloat(a.price_eur.toString())):0,in_stock:a.stock_quantity>0,image_url:a.product_images?.[0]?.url?f(a.product_images[0].url):g(a.name),image:a.product_images?.[0]?.url?f(a.product_images[0].url):g(a.name),is_organic:a.organic_certified||!1,is_biodynamic:a.biodynamic_certified||!1,is_featured:a.featured||!1,slug:a.slug_en||a.slug_fr||`${a.name}-${a.vintage}`.toLowerCase().replace(/[àáâãäå]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ÿý]/g,"y").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/[«»\"']/g,"").replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}))}catch(a){return console.error("Error fetching featured products from database:",a),[{id:"1",name:"Vinsobres rouge \xab Fran\xe7ois \xbb",slug:"vinsobres-rouge-francois-2022",description:"A premium red wine with notes of dark fruit and traditional terroir expression.",price_eur:12,price:1200,vintage:2022,grape_variety:"Syrah blend",producer:"Domaine Vallot",region:"Vinsobres",stock_quantity:50,is_organic:!0,is_biodynamic:!0,featured:!0,image_url:"/images/wine-bottle-red.svg",image:"/images/wine-bottle-red.svg",created_at:new Date().toISOString()},{id:"2",name:"Vinsobres Cuv\xe9e \xab Claude \xbb",slug:"vinsobres-cuvee-claude-2018",description:"From 67-year-old vines, this wine benefits from barrel aging for exceptional complexity.",price_eur:14.5,price:1450,vintage:2018,grape_variety:"Old vine Syrah",producer:"Domaine Vallot",region:"Vinsobres",stock_quantity:30,is_organic:!0,is_biodynamic:!0,featured:!0,image_url:"/images/wine-bottle-red.svg",image:"/images/wine-bottle-red.svg",created_at:new Date().toISOString()},{id:"3",name:"Vinsobres Le Haut des C\xf4tes",slug:"vinsobres-le-haut-des-cotes-2018",description:"Deep red color with intense bouquet of vanilla and forest floor notes.",price_eur:16.5,price:1650,vintage:2018,grape_variety:"Syrah, Grenache",producer:"Domaine Vallot",region:"Vinsobres",stock_quantity:25,is_organic:!0,is_biodynamic:!0,featured:!0,image_url:"/images/wine-bottle-red.svg",image:"/images/wine-bottle-red.svg",created_at:new Date().toISOString()}]}},o=async a=>l(async b=>b.from("cart_items").select(`
        *,
        wine_products (*)
      `).eq("user_id",a)),p=async(a,b,c)=>l(async d=>{let{data:e}=await d.from("cart_items").select("*").eq("user_id",a).eq("product_id",b).single();return e?d.from("cart_items").update({quantity:e.quantity+c}).eq("id",e.id).select().single():d.from("cart_items").insert({user_id:a,product_id:b,quantity:c}).select().single()}),q=async(a,b,c)=>l(async d=>d.from("cart_items").update({quantity:c}).eq("id",b).eq("user_id",a).select().single()),r=async(a,b)=>l(async c=>c.from("cart_items").delete().eq("id",b).eq("user_id",a)),s=async a=>l(async b=>{let{data:c,error:d}=await b.from("orders").insert({user_id:a.user_id,customer_email:a.customer_email,customer_first_name:a.customer_first_name,customer_last_name:a.customer_last_name,shipping_address:a.shipping_address,billing_address:a.billing_address||a.shipping_address,subtotal:a.subtotal,vat_amount:a.vat_amount,shipping_cost:a.shipping_cost,total_amount:a.total_amount,payment_method:a.payment_method||"mollie",status:a.status||"pending"}).select().single();if(d)throw d;let e=a.items.map(a=>({order_id:c.id,product_id:a.product_id,quantity:a.quantity,unit_price:a.unit_price,total_price:a.quantity*a.unit_price})),{error:f}=await b.from("order_items").insert(e);if(f)throw f;return{data:c,error:null}}),t=async(a,b)=>l(async c=>{let d=c.from("orders").select(`
        *,
        order_items (
          *,
          wine_products (*)
        )
      `).eq("id",a);return b&&(d=d.eq("user_id",b)),d.single()})},48648:(a,b,c)=>{"use strict";c.d(b,{Q5:()=>h,Y_:()=>g,sh:()=>f});class d{constructor(){if(this.apiKey=process.env.MOLLIE_API_KEY||"",this.isTestMode=this.apiKey.startsWith("test_"),this.baseUrl="https://api.mollie.com/v2",!this.apiKey)throw Error("MOLLIE_API_KEY environment variable is required")}async createPayment(a){let b={amount:{currency:a.currency||"EUR",value:this.formatAmount(a.amount,a.currency||"EUR")},description:a.description,redirectUrl:a.redirectUrl,webhookUrl:a.webhookUrl,metadata:{orderId:a.orderId,customerEmail:a.customerEmail,...a.metadata},locale:a.locale||"en_US",method:a.method?.map(a=>a.id)};return await this.makeRequest("POST","/payments",b)}async getPayment(a){return await this.makeRequest("GET",`/payments/${a}`)}async cancelPayment(a){return await this.makeRequest("DELETE",`/payments/${a}`)}async createRefund(a,b,c,d="EUR"){let e={};return b&&(e.amount={currency:d,value:this.formatAmount(b,d)}),c&&(e.description=c),await this.makeRequest("POST",`/payments/${a}/refunds`,e)}async getPaymentMethods(a,b="EUR",c){let d="/methods",e=new URLSearchParams;a&&(e.append("amount[currency]",b),e.append("amount[value]",this.formatAmount(a,b))),c&&e.append("locale",c),e.toString()&&(d+=`?${e.toString()}`);let f=await this.makeRequest("GET",d);return f._embedded?.methods||[]}verifyWebhookSignature(a,b){return!0}async verifyWebhook(a){try{return await this.getPayment(a)}catch(a){return console.error("Failed to verify webhook:",a),null}}isPaymentSuccessful(a){return"paid"===a||"authorized"===a}isPaymentPending(a){return"open"===a||"pending"===a}isPaymentFailed(a){return"failed"===a||"canceled"===a||"expired"===a}getWineCompatibleMethods(){return["ideal","creditcard","bancontact","sofort","eps","giropay","belfius","paypal","applepay","przelewy24"]}formatAmount(a,b){return(a/100).toFixed(2)}async makeRequest(a,b,c){let d=`${this.baseUrl}${b}`,f={method:a,headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"}};c&&(f.body=JSON.stringify(c));try{let a=await fetch(d,f);if(!a.ok){let b=await a.json().catch(()=>({}));throw new e(b.title||"Payment API error",a.status,b.detail||a.statusText,b)}return await a.json()}catch(a){if(a instanceof e)throw a;throw new e("Payment service unavailable",500,"Unable to connect to payment provider",{originalError:a})}}}class e extends Error{constructor(a,b,c,d){super(a),this.name="MollieError",this.status=b,this.detail=c,this.data=d}toJSON(){return{name:this.name,message:this.message,status:this.status,detail:this.detail,data:this.data}}}let f=new d,g=async a=>{let b=process.env.NEXT_PUBLIC_BASE_URL||"http://localhost:3000";return f.createPayment({orderId:a.orderId,amount:a.amount,currency:"EUR",description:a.description||`Wine order ${a.orderId}`,customerEmail:a.customerEmail,customerName:a.customerName,redirectUrl:`${b}/orders/${a.orderId}?payment=success`,webhookUrl:`${b}/api/webhooks/mollie`,locale:a.locale||"en_US",method:f.getWineCompatibleMethods().map(a=>({id:a,name:a})),metadata:{orderType:"wine",customerAge:"verified"}})},h=async a=>{let b=await f.verifyWebhook(a);if(!b)throw Error("Invalid payment webhook");return{payment:b,isSuccessful:f.isPaymentSuccessful(b.status),isPending:f.isPaymentPending(b.status),isFailed:f.isPaymentFailed(b.status)}}},78335:()=>{},96487:()=>{}};