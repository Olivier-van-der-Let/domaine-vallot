(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4490],{3625:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var n=t(5155),s=t(3691),a=t(63),i=t(2115);function o(e){let{children:r,fallback:t}=e,{user:o,isAdmin:l,loading:c}=(0,s.A)(),d=(0,a.useRouter)();return((0,i.useEffect)(()=>{if(!c){if(!o)return void d.push("/login?message=Please login to access admin panel");if(!l)return void d.push("/?message=Admin access required")}},[o,l,c,d]),c)?(0,n.jsxs)("div",{className:"min-h-screen flex items-center justify-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-wine-600"}),(0,n.jsx)("span",{className:"ml-3 text-gray-600",children:"Checking access..."})]}):o&&l?(0,n.jsx)(n.Fragment,{children:r}):t||(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Admin privileges required to access this page."})]})})}var l=t(2619),c=t.n(l),d=t(4269);function u(e){let{children:r,params:t}=e,s=(0,a.usePathname)(),i=[{name:"Dashboard",href:"/admin",icon:(0,n.jsxs)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v14l-5-3-5 3V5z"})]})},{name:"Products",href:"/admin/products",icon:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})},{name:"Orders",href:"/admin/orders",icon:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})},{name:"Customers",href:"/admin/customers",icon:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})},{name:"Settings",href:"/admin/settings",icon:(0,n.jsxs)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}];return(0,n.jsx)(o,{children:(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)("div",{className:"fixed inset-y-0 left-0 w-64 bg-white shadow-lg",children:(0,n.jsxs)("div",{className:"flex flex-col h-full",children:[(0,n.jsx)("div",{className:"flex items-center justify-center h-16 px-4 bg-wine-600 text-white",children:(0,n.jsx)("h1",{className:"text-lg font-semibold",children:"Admin Panel"})}),(0,n.jsx)("nav",{className:"flex-1 p-4 space-y-2",children:i.map(e=>{let r=s===e.href||"/admin"!==e.href&&(null==s?void 0:s.startsWith(e.href));return(0,n.jsxs)(c(),{href:e.href,className:(0,d.cn)("flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium transition-colors",r?"bg-wine-100 text-wine-700 border-r-2 border-wine-600":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"),children:[e.icon,(0,n.jsx)("span",{children:e.name})]},e.href)})}),(0,n.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,n.jsxs)(c(),{href:"/",className:"flex items-center space-x-2 text-sm text-gray-500 hover:text-gray-700 transition-colors",children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,n.jsx)("span",{children:"Back to Website"})]})})]})}),(0,n.jsx)("div",{className:"ml-64 min-h-screen",children:(0,n.jsx)("main",{className:"p-8",children:r})})]})})}},3691:(e,r,t)=>{"use strict";t.d(r,{A:()=>c,AuthProvider:()=>l});var n=t(5155),s=t(2115),a=t(63),i=t(8760);let o=(0,s.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),[m,f]=(0,s.useState)(!0),[p,v]=(0,s.useState)(!1),x=(0,a.useRouter)(),g=(0,a.usePathname)(),w=(0,i.createClientComponentClient)(),j=async()=>{try{var e;let{data:{session:r},error:t}=await w.auth.getSession();if(t)return void console.error("Session error:",t);h(r),l(null!=(e=null==r?void 0:r.user)?e:null),(null==r?void 0:r.user)?(await y(r.user.id),await k(r.user.id)):(d(null),v(!1))}catch(e){console.error("Session fetch error:",e)}finally{f(!1)}},y=async e=>{try{let{data:r,error:t}=await w.from("customers").select("*").eq("id",e).single();if(t)return void console.error("Customer profile error:",t);if(r){let e={id:r.id,email:r.email,firstName:r.first_name||"",lastName:r.last_name||"",phone:r.phone||"",birthDate:r.birth_date||"",preferredLanguage:r.preferred_language||"en",marketingConsent:r.marketing_consent||!1,newsletterConsent:r.newsletter_consent||!1,ageVerified:r.age_verified||!1,ageVerifiedAt:r.age_verified_at||"",ageVerificationMethod:r.age_verification_method||void 0,isBusiness:r.is_business||!1,vatNumber:r.vat_number||"",vatValidated:r.vat_validated||!1,vatValidatedAt:r.vat_validated_at||"",companyName:r.company_name||"",totalOrders:r.total_orders||0,totalSpentEur:r.total_spent_eur||0,createdAt:r.created_at,updatedAt:r.updated_at};d(e)}}catch(e){console.error("Customer profile fetch error:",e)}},k=async e=>{try{let{data:r,error:t}=await w.from("admin_users").select("user_id").eq("user_id",e).single();if(t&&"PGRST116"!==t.code){console.error("Admin check error:",t),v(!1);return}v(!!r)}catch(e){console.error("Admin status check error:",e),v(!1)}},N=async(e,r)=>{try{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r})}),n=await t.json();if(!t.ok)return{error:n.error||"Login failed"};return await j(),{}}catch(e){return{error:"An unexpected error occurred"}}},_=async function(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let n=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r,confirmPassword:r,...t})}),s=await n.json();if(!n.ok)return{error:s.error||"Registration failed"};return await j(),{}}catch(e){return{error:"An unexpected error occurred"}}},b=async()=>{try{await w.auth.signOut(),l(null),d(null),h(null),x.refresh()}catch(e){console.error("Sign out error:",e)}},C=async e=>{try{let r=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),t=await r.json();if(!r.ok)return{error:t.error||"Password reset failed"};return{}}catch(e){return{error:"An unexpected error occurred"}}},S=async e=>{try{let{error:r}=await w.auth.updateUser({password:e});if(r)return{error:r.message};return{}}catch(e){return{error:"An unexpected error occurred"}}},A=async()=>{await j()};return(0,s.useEffect)(()=>{j();let{data:{subscription:e}}=w.auth.onAuthStateChange(async(e,r)=>{var t;if(h(r),l(null!=(t=null==r?void 0:r.user)?t:null),(null==r?void 0:r.user)?(await y(r.user.id),await k(r.user.id)):(d(null),v(!1)),"SIGNED_OUT"===e&&(d(null),v(!1),x.refresh()),"SIGNED_IN"===e){let e=new URLSearchParams(window.location.search).get("redirect");e&&x.push(e)}"PASSWORD_RECOVERY"===e&&x.push("/reset-password?token=".concat(null==r?void 0:r.access_token)),f(!1)});return()=>e.unsubscribe()},[x,w.auth]),(0,s.useEffect)(()=>{if(!m){let e=(null==g?void 0:g.includes("/login"))||(null==g?void 0:g.includes("/register"))||(null==g?void 0:g.includes("/forgot-password"))||(null==g?void 0:g.includes("/reset-password")),r=null==g?void 0:g.includes("/admin"),n=(null==g?void 0:g.includes("/profile"))||(null==g?void 0:g.includes("/orders"));if(t&&e){let e=new URLSearchParams(window.location.search).get("redirect");(null==e?void 0:e.includes("/admin"))&&p?x.push(e):x.push("/");return}if(r)if(t){if(t&&!p)return void x.push("/?message=Admin access required")}else{let e=encodeURIComponent(g||"/admin");x.push("/login?redirect=".concat(e,"&message=Please login to access admin panel"));return}if(!t&&n){let e=encodeURIComponent(g||"/");x.push("/login?redirect=".concat(e));return}}},[t,m,p,g,x]),(0,n.jsx)(o.Provider,{value:{user:t,customer:c,session:u,loading:m,isAdmin:p,signIn:N,signUp:_,signOut:b,resetPassword:C,updatePassword:S,refreshUser:A},children:r})}function c(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4269:(e,r,t)=>{"use strict";t.d(r,{cn:()=>a});var n=t(2821),s=t(5889);function a(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.QP)((0,n.$)(r))}},5812:(e,r,t)=>{Promise.resolve().then(t.bind(t,3625))}},e=>{e.O(0,[2619,8760,760,8441,1255,7358],()=>e(e.s=5812)),_N_E=e.O()}]);