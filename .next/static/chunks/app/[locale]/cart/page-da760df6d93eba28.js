(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2280],{210:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>x});var t=a(5155),r=a(2115),i=a(2619),l=a.n(i),d=a(5239);function n(e){var s,a;let{cart:i,loading:d=!1,error:n=null,onUpdateQuantity:x,onRemoveItem:u,onProceedToCheckout:h,className:p=""}=e,[g,j]=(0,r.useState)(new Set),y=async(e,s)=>{if(x){j(s=>new Set(s).add(e));try{await x(e,s)}catch(e){console.error("Failed to update quantity:",e)}finally{j(s=>{let a=new Set(s);return a.delete(e),a})}}},v=async e=>{if(u){j(s=>new Set(s).add(e));try{await u(e)}catch(s){console.error("Failed to remove item:",s),j(s=>{let a=new Set(s);return a.delete(e),a})}}};return d?(0,t.jsx)(m,{}):n?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-red-600 mb-4",children:(0,t.jsx)("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Cart"}),(0,t.jsx)("p",{className:"text-gray-600",children:n})]}):i&&0!==i.items.length?(0,t.jsxs)("div",{className:"max-w-4xl mx-auto ".concat(p),"data-testid":"cart-component",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2","data-testid":"cart-title",children:"Shopping Cart"}),(0,t.jsxs)("p",{className:"text-gray-600",children:[i.summary.total_items," ",1===i.summary.total_items?"item":"items"," in your cart"]})]}),((null==(s=i.issues)?void 0:s.out_of_stock_items.length)||(null==(a=i.issues)?void 0:a.unavailable_quantities.length))&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-red-800 mb-2",children:"Cart Issues"}),(0,t.jsxs)("ul",{className:"text-sm text-red-700 space-y-1",children:[i.issues.out_of_stock_items.map(e=>(0,t.jsxs)("li",{children:["• ",e.product_name,": ",e.message]},e.item_id)),i.issues.unavailable_quantities.map(e=>(0,t.jsxs)("li",{children:["• ",e.product_name,": ",e.message]},e.item_id))]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)("div",{className:"space-y-4",children:i.items.map(e=>(0,t.jsx)(c,{item:e,isUpdating:g.has(e.id),onQuantityChange:y,onRemove:v},e.id))})}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsx)(o,{summary:i.summary,onProceedToCheckout:h})})]})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-gray-400 mb-4",children:(0,t.jsx)("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.68 8.28A2 2 0 006.38 22h11.24a2 2 0 001.06-.82L21 13M7 13v6a2 2 0 002 2h6a2 2 0 002-2v-6"})})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Your Cart is Empty"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Add some wines to get started!"}),(0,t.jsx)(l(),{href:"/products",className:"inline-block bg-gray-900 text-white px-6 py-3 rounded-md font-medium hover:bg-gray-800",children:"Browse Wines"})]})}function c(e){var s;let{item:a,isUpdating:r,onQuantityChange:i,onRemove:l}=e,n=a.warnings&&a.warnings.length>0;return(0,t.jsxs)("div",{className:"bg-white border rounded-lg p-4 ".concat(n?"border-red-200":"border-gray-200"),"data-testid":"cart-item",children:[(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-20 h-24 bg-gray-100 rounded-lg overflow-hidden",children:(0,t.jsx)(d.default,{src:a.product.image_url,alt:a.product.name,width:80,height:96,className:"w-full h-full object-cover"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 truncate",children:a.product.name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.product.vintage&&(0,t.jsx)("span",{children:a.product.vintage}),(0,t.jsx)("span",{className:"capitalize",children:a.product.category.replace("_"," ")}),a.product.volume&&(0,t.jsxs)("span",{children:[a.product.volume,"ml"]})]})]}),(0,t.jsx)("button",{onClick:()=>l(a.id),disabled:r,className:"text-gray-400 hover:text-red-600 disabled:opacity-50","data-testid":"remove-item-button",children:(0,t.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n&&(0,t.jsx)("div",{className:"mb-3",children:null==(s=a.warnings)?void 0:s.map((e,s)=>(0,t.jsx)("p",{className:"text-sm text-red-600",children:e.message},s))}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center border border-gray-300 rounded-md","data-testid":"quantity-controls",children:[(0,t.jsx)("button",{onClick:()=>i(a.id,a.quantity-1),disabled:r||a.quantity<=1,className:"px-3 py-1 text-gray-600 hover:text-gray-900 disabled:opacity-50","data-testid":"decrease-quantity",children:"-"}),(0,t.jsx)("span",{className:"px-4 py-1 border-l border-r border-gray-300 min-w-[3rem] text-center",children:a.quantity}),(0,t.jsx)("button",{onClick:()=>i(a.id,a.quantity+1),disabled:r||a.quantity>=a.product.stock_quantity,className:"px-3 py-1 text-gray-600 hover:text-gray-900 disabled:opacity-50","data-testid":"increase-quantity",children:"+"})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["€",a.product.price_display," each"]}),(0,t.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["€",a.subtotal_display]})]})]})]})]}),r&&(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600",children:[(0,t.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-gray-300 border-t-gray-600 rounded-full"}),"Updating..."]})]})}function o(e){let{summary:s,onProceedToCheckout:a}=e,r=s.validations.has_items&&s.validations.all_in_stock&&s.validations.all_available&&s.validations.minimum_order_met;return(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 sticky top-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Summary"}),(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsxs)("span",{children:["Items (",s.total_items,")"]}),(0,t.jsxs)("span",{children:["€",s.subtotal_display]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,t.jsx)("span",{children:"Shipping"}),(0,t.jsx)("span",{children:"Calculated at checkout"})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,t.jsx)("span",{children:"VAT"}),(0,t.jsx)("span",{children:"Calculated at checkout"})]})]}),(0,t.jsx)("div",{className:"border-t border-gray-200 pt-4 mb-6",children:(0,t.jsxs)("div",{className:"flex justify-between font-semibold text-lg","data-testid":"cart-total",children:[(0,t.jsx)("span",{children:"Subtotal"}),(0,t.jsxs)("span",{children:["€",s.subtotal_display]})]})}),!s.validations.minimum_order_met&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,t.jsx)("p",{className:"text-sm text-yellow-800",children:"Minimum order value is €10.00"})}),!s.validations.maximum_bottles_limit&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsx)("p",{className:"text-sm text-red-800",children:"Maximum 100 bottles per order for shipping"})}),s.age_verification_required&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-md",children:(0,t.jsx)("p",{className:"text-sm text-amber-800",children:"Age verification required (18+)"})}),(0,t.jsx)("button",{onClick:a,disabled:!r,className:"w-full bg-gray-900 text-white px-6 py-3 rounded-md font-medium hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed","data-testid":"checkout-button",children:r?"Proceed to Checkout":"Cannot Proceed to Checkout"}),(0,t.jsxs)("div",{className:"mt-4 text-xs text-gray-600 space-y-1",children:[(0,t.jsx)("p",{children:"• Free shipping on orders over €75"}),(0,t.jsx)("p",{children:"• Secure checkout with SSL encryption"}),(0,t.jsx)("p",{children:"• Age verification required upon delivery"})]})]})}function m(){return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48 mb-2 animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-32 animate-pulse"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,t.jsx)("div",{className:"lg:col-span-2 space-y-4",children:Array.from({length:3}).map((e,s)=>(0,t.jsx)("div",{className:"bg-white border rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("div",{className:"w-20 h-24 bg-gray-200 rounded-lg animate-pulse"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"h-5 bg-gray-200 rounded w-3/4 mb-2 animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-4 animate-pulse"}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-24 animate-pulse"}),(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-16 animate-pulse"})]})]})]})},s))}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-32 mb-4 animate-pulse"}),(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})]}),(0,t.jsx)("div",{className:"h-12 bg-gray-200 rounded animate-pulse"})]})})]})]})}function x(e){let{params:{locale:s}}=e,[a,i]=(0,r.useState)([]),[d,c]=(0,r.useState)({itemCount:0,totalQuantity:0,subtotalEur:0}),[o,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(!0),[h,p]=(0,r.useState)(null),[g,j]=(0,r.useState)(null);(0,r.useEffect)(()=>{y()},[]);let y=async()=>{try{var e,s,a,t;u(!0),p(null);let r=await fetch("/api/cart");if(!r.ok)throw Error("Failed to fetch cart");let l=await r.json();i((null==(e=l.data)?void 0:e.items)||[]),c((null==(s=l.data)?void 0:s.summary)||{itemCount:0,totalQuantity:0,subtotalEur:0}),(null==(t=l.data)||null==(a=t.items)?void 0:a.length)>0?await v(l.data.summary.subtotalEur):m(null)}catch(e){p(e instanceof Error?e.message:"An error occurred"),i([]),c({itemCount:0,totalQuantity:0,subtotalEur:0}),m(null)}finally{u(!1)}},v=async e=>{try{let s=await fetch("/api/vat/calculate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,countryCode:"FR",productCategory:"wine"})});if(s.ok){let e=await s.json();m(e.data)}}catch(e){console.error("Error calculating VAT:",e)}},b=async(e,s)=>{if(s<=0)return void N(e);try{if(j(e),!(await fetch("/api/cart/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:s})})).ok)throw Error("Failed to update quantity");await y()}catch(e){console.error("Error updating quantity:",e),p("Failed to update quantity")}finally{j(null)}},N=async e=>{try{if(j(e),!(await fetch("/api/cart/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to remove item");await y()}catch(e){console.error("Error removing item:",e),p("Failed to remove item")}finally{j(null)}},f=async()=>{if(a.length)try{u(!0),await Promise.all(a.map(e=>fetch("/api/cart/".concat(e.id),{method:"DELETE"}))),await y()}catch(e){console.error("Error clearing cart:",e),p("Failed to clear cart")}finally{u(!1)}},w=o?o.grossAmount:d.subtotalEur;return x?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,t.jsxs)("div",{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48 mb-8"}),(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,t.jsx)("div",{className:"lg:col-span-2 space-y-4",children:Array.from({length:3}).map((e,s)=>(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsx)("div",{className:"w-20 h-20 bg-gray-200 rounded"}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})},s))}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6 h-fit",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-10 bg-gray-200 rounded"})]})})]})]})})}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 font-playfair",children:"fr"===s?"Votre Panier":"Your Cart"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:d.itemCount>0?"fr"===s?"".concat(d.itemCount," article").concat(d.itemCount>1?"s":""," dans votre panier"):"".concat(d.itemCount," item").concat(d.itemCount>1?"s":""," in your cart"):"fr"===s?"Votre panier est vide":"Your cart is empty"})]}),a.length>0&&(0,t.jsx)("button",{onClick:f,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"fr"===s?"Vider le panier":"Clear Cart"})]}),h&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-6",children:(0,t.jsx)("p",{className:"text-red-700",children:h})}),0===a.length?(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 text-gray-400",children:(0,t.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.68 8.28A2 2 0 006.38 22h11.24a2 2 0 001.06-.82L21 13M7 13v6a2 2 0 002 2h6a2 2 0 002-2v-6"})})}),(0,t.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"fr"===s?"Votre panier est vide":"Your cart is empty"}),(0,t.jsx)("p",{className:"text-gray-600 mb-8",children:"fr"===s?"D\xe9couvrez notre s\xe9lection de vins biodynamiques exceptionnels.":"Discover our selection of exceptional biodynamic wines."}),(0,t.jsx)(l(),{href:"/".concat(s,"/products"),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 transition-colors",children:"fr"===s?"D\xe9couvrir nos vins":"Browse Wines"})]}):(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)(n,{items:a,locale:s,onUpdateQuantity:b,onRemoveItem:N,updatingItemId:g})}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 h-fit",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"fr"===s?"R\xe9sum\xe9 de la commande":"Order Summary"}),(0,t.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,t.jsxs)("span",{children:["fr"===s?"Sous-total":"Subtotal"," (",d.totalQuantity," ","fr"===s?"articles":"items",")"]}),(0,t.jsxs)("span",{children:["€",d.subtotalEur.toFixed(2)]})]}),o&&(0,t.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,t.jsxs)("span",{children:["TVA (",(100*o.vatRate).toFixed(1),"%)"]}),(0,t.jsxs)("span",{children:["€",o.vatAmount.toFixed(2)]})]}),(0,t.jsx)("div",{className:"border-t pt-3",children:(0,t.jsxs)("div",{className:"flex justify-between font-semibold text-gray-900 text-lg",children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsxs)("span",{children:["€",w.toFixed(2)]})]})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(l(),{href:"/".concat(s,"/checkout"),className:"w-full bg-purple-600 text-white py-3 px-4 rounded-md font-medium hover:bg-purple-700 transition-colors text-center block",children:"fr"===s?"Passer la commande":"Proceed to Checkout"}),(0,t.jsx)(l(),{href:"/".concat(s,"/products"),className:"w-full bg-gray-100 text-gray-900 py-3 px-4 rounded-md font-medium hover:bg-gray-200 transition-colors text-center block",children:"fr"===s?"Continuer les achats":"Continue Shopping"})]}),(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t text-sm text-gray-600",children:[(0,t.jsxs)("div",{className:"flex items-center mb-2",children:[(0,t.jsx)("svg",{className:"w-5 h-5 mr-2 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,t.jsx)("span",{children:"fr"===s?"Livraison gratuite d\xe8s 75€":"Free shipping from €75"})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("svg",{className:"w-5 h-5 mr-2 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{children:"fr"===s?"Paiement s\xe9curis\xe9":"Secure payment"})]})]})]})]})]})})}},3586:(e,s,a)=>{Promise.resolve().then(a.bind(a,210))}},e=>{e.O(0,[2619,5239,8441,1255,7358],()=>e(e.s=3586)),_N_E=e.O()}]);