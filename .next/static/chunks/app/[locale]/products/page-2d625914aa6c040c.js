(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4358],{63:(e,r,t)=>{"use strict";t.r(r);var a=t(7260),s={};for(let e in a)"default"!==e&&(s[e]=()=>a[e]);t.d(r,s)},2696:(e,r,t)=>{Promise.resolve().then(t.bind(t,8482))},3011:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"useMergedRef",{enumerable:!0,get:function(){return s}});let a=t(2115);function s(e,r){let t=(0,a.useRef)(null),s=(0,a.useRef)(null);return(0,a.useCallback)(a=>{if(null===a){let e=t.current;e&&(t.current=null,e());let r=s.current;r&&(s.current=null,r())}else e&&(t.current=i(e,a)),r&&(s.current=i(r,a))},[e,r])}function i(e,r){if("function"!=typeof e)return e.current=r,()=>{e.current=null};{let t=e(r);return"function"==typeof t?t:()=>e(null)}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)},8482:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>d});var a=t(5155),s=t(2115),i=t(5239),n=t(63);function l(e){let{products:r=[],loading:t=!1,error:i=null,onProductClick:l,className:d="",itemsPerRow:u=3,showQuickAdd:m=!0,maxItems:x}=e,p=(0,n.useRouter)(),[g,h]=(0,s.useState)(null),f=x?r.slice(0,x):r,v={2:"grid-cols-1 sm:grid-cols-2",3:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",6:"grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6"},b=e=>{if(l)l(e);else{let r=e.slug||y(e)||e.id;p.push("/products/".concat(r))}},y=e=>{if(!e.name)return null;let r=e.name.toLowerCase().replace(/[àáâãäå]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ÿý]/g,"y").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/[«»"']/g,"").replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"");return e.vintage?"".concat(r,"-").concat(e.vintage):r},j=async(e,r)=>{e.preventDefault(),e.stopPropagation(),h(r);try{(await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:r,quantity:1})})).ok||console.error("Failed to add product to cart")}catch(e){console.error("Error adding to cart:",e)}finally{h(null)}};return t?(0,a.jsx)("div",{className:"grid ".concat(v[u]," gap-6 ").concat(d),"data-testid":"product-grid",children:Array.from({length:2*u}).map((e,r)=>(0,a.jsx)(o,{},r))}):i?(0,a.jsxs)("div",{className:"text-center py-12","data-testid":"error-message",children:[(0,a.jsx)("div",{className:"text-red-600 mb-4",children:(0,a.jsx)("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Products"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:i}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700","data-testid":"retry-button",children:"Try Again"})]}):0===f.length?(0,a.jsxs)("div",{className:"text-center py-12","data-testid":"empty-state",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-4",children:(0,a.jsx)("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Products Found"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Try adjusting your search or filter criteria."})]}):(0,a.jsx)("div",{className:"grid ".concat(v[u]," gap-6 ").concat(d),"data-testid":"product-grid",children:f.map(e=>(0,a.jsx)(c,{product:e,onProductClick:b,onQuickAdd:m?j:void 0,isAddingToCart:g===e.id},e.id))})}function c(e){var r,t;let{product:s,onProductClick:n,onQuickAdd:l,isAddingToCart:c}=e;return(0,a.jsxs)("div",{className:"group relative bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer",onClick:()=>n(s),"data-testid":"product-card",children:[(0,a.jsxs)("div",{className:"aspect-[3/4] bg-gray-100 rounded-t-lg overflow-hidden",children:[(0,a.jsx)(i.default,{src:s.image_url||"/images/default-wine.svg",alt:s.name,width:300,height:400,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200","data-testid":"product-image",onError:e=>{e.target.src="/images/default-wine.svg"}}),(0,a.jsxs)("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:[!s.in_stock&&(0,a.jsx)("span",{className:"px-2 py-1 bg-red-600 text-white text-xs font-medium rounded",children:"Out of Stock"}),s.is_organic&&(0,a.jsx)("span",{className:"px-2 py-1 bg-green-600 text-white text-xs font-medium rounded",children:"Organic"}),s.is_featured&&(0,a.jsx)("span",{className:"px-2 py-1 bg-purple-600 text-white text-xs font-medium rounded",children:"Featured"})]}),l&&s.in_stock&&(0,a.jsx)("button",{onClick:e=>l(e,s.id),disabled:c,className:"absolute bottom-2 right-2 bg-white text-gray-900 px-3 py-2 rounded-md text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 shadow-md hover:bg-gray-50 disabled:opacity-50","data-testid":"quick-add-button",children:c?"Adding...":"Quick Add"})]}),(0,a.jsxs)("div",{className:"p-4",children:[(s.producer||s.region)&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:[s.producer,s.region].filter(Boolean).join(" • ")}),(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-1 line-clamp-2","data-testid":"product-name",children:s.name}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[s.vintage&&(0,a.jsx)("span",{children:s.vintage}),(0,a.jsx)("span",{className:"capitalize",children:null==(r=s.category)?void 0:r.replace("_"," ")}),s.alcohol_content&&(0,a.jsxs)("span",{children:[s.alcohol_content,"% ABV"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-lg font-semibold text-gray-900","data-testid":"product-price",children:["€","NaN"!==s.price_display?s.price_display:(null==(t=s.price)?void 0:t.toFixed(2))||"0.00"]}),(0,a.jsx)("span",{className:"text-sm text-gray-600 ml-1",children:"per bottle"})]}),(0,a.jsx)("div",{className:"flex items-center text-sm",children:s.in_stock?s.stock_quantity<=5?(0,a.jsxs)("span",{className:"text-orange-600",children:["Only ",s.stock_quantity," left"]}):(0,a.jsx)("span",{className:"text-green-600",children:"In Stock"}):(0,a.jsx)("span",{className:"text-red-600",children:"Out of Stock"})})]})]})]})}function o(){return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"aspect-[3/4] bg-gray-200 rounded-t-lg animate-pulse"}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2 animate-pulse"}),(0,a.jsx)("div",{className:"h-5 bg-gray-200 rounded mb-2 animate-pulse"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2 animate-pulse"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-20 animate-pulse"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-16 animate-pulse"})]})]})]})}function d(e){let{params:r,searchParams:t}=e,{locale:i}=(0,s.use)(r),n=(0,s.use)(t),[c,o]=(0,s.useState)([]),[d,u]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[p,g]=(0,s.useState)(0),[h,f]=(0,s.useState)(1),[v,b]=(0,s.useState)({featured:"true"===n.featured,inStock:"true"===n.inStock,query:n.q||"",minPrice:n.minPrice?Number(n.minPrice):void 0,maxPrice:n.maxPrice?Number(n.maxPrice):void 0,vintage:n.vintage?Number(n.vintage):void 0,varietal:n.varietal||void 0,certification:n.certification||void 0}),[y,j]=(0,s.useState)({field:"name",direction:"asc"});(0,s.useEffect)(()=>{N()},[v,y,h]);let N=async()=>{try{var e;u(!0),x(null);let r=new URLSearchParams;r.append("page",h.toString()),r.append("limit","12"),r.append("sortBy",y.field),r.append("sortOrder",y.direction),v.query&&r.append("q",v.query),v.featured&&r.append("featured","true"),v.inStock&&r.append("inStock","true"),v.minPrice&&r.append("minPrice",v.minPrice.toString()),v.maxPrice&&r.append("maxPrice",v.maxPrice.toString()),v.vintage&&r.append("vintage",v.vintage.toString()),v.varietal&&r.append("varietal",v.varietal),v.certification&&r.append("certification",v.certification);let t=await fetch("/api/products?".concat(r.toString()));if(!t.ok)throw Error("Failed to fetch products");let a=await t.json();o(a.data||[]),g((null==(e=a.pagination)?void 0:e.total)||0)}catch(e){x(e instanceof Error?e.message:"An error occurred"),o([])}finally{u(!1)}},w=e=>{b(r=>({...r,...e})),f(1)},k=Math.ceil(p/12);return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 font-playfair mb-4",children:"fr"===i?"Nos Vins":"Our Wines"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 max-w-2xl",children:"fr"===i?"D\xe9couvrez notre collection de vins biodynamiques, chacun refl\xe9tant la richesse unique de notre terroir.":"Discover our collection of biodynamic wines, each reflecting the unique richness of our terroir."})]}),(0,a.jsxs)("div",{className:"lg:grid lg:grid-cols-4 lg:gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8 lg:mb-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"fr"===i?"Filtres":"Filters"}),(0,a.jsx)("button",{onClick:()=>{b({featured:!1,inStock:!1,query:"",minPrice:void 0,maxPrice:void 0,vintage:void 0,varietal:void 0,certification:void 0}),f(1)},className:"text-sm text-purple-600 hover:text-purple-700",children:"fr"===i?"Effacer":"Clear"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-2",children:"fr"===i?"Recherche":"Search"}),(0,a.jsx)("input",{type:"text",id:"search",value:v.query||"",onChange:e=>{w({query:e.target.value})},placeholder:"fr"===i?"Nom du vin...":"Wine name...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"fr"===i?"Filtres rapides":"Quick Filters"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:v.featured||!1,onChange:e=>w({featured:e.target.checked}),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"fr"===i?"En vedette":"Featured"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:v.inStock||!1,onChange:e=>w({inStock:e.target.checked}),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"fr"===i?"En stock":"In Stock"})]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"fr"===i?"Prix (€)":"Price (€)"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)("input",{type:"number",placeholder:"Min",value:v.minPrice||"",onChange:e=>w({minPrice:e.target.value?Number(e.target.value):void 0}),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,a.jsx)("input",{type:"number",placeholder:"Max",value:v.maxPrice||"",onChange:e=>w({maxPrice:e.target.value?Number(e.target.value):void 0}),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"vintage",className:"block text-sm font-medium text-gray-700 mb-2",children:"fr"===i?"Mill\xe9sime":"Vintage"}),(0,a.jsxs)("select",{id:"vintage",value:v.vintage||"",onChange:e=>w({vintage:e.target.value?Number(e.target.value):void 0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"fr"===i?"Tous":"All"}),Array.from({length:10},(e,r)=>2024-r).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Certification"}),(0,a.jsxs)("select",{value:v.certification||"",onChange:e=>w({certification:e.target.value||void 0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"fr"===i?"Toutes":"All"}),(0,a.jsx)("option",{value:"organic",children:"fr"===i?"Biologique":"Organic"}),(0,a.jsx)("option",{value:"biodynamic",children:"fr"===i?"Biodynamique":"Biodynamic"}),(0,a.jsx)("option",{value:"vegan",children:"Vegan"})]})]})]})}),(0,a.jsxs)("div",{className:"lg:col-span-3",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[(0,a.jsx)("div",{className:"text-sm text-gray-700 mb-4 sm:mb-0",children:"fr"===i?"".concat(p," produit").concat(1!==p?"s":""," trouv\xe9").concat(1!==p?"s":""):"".concat(p," product").concat(1!==p?"s":""," found")}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("label",{htmlFor:"sort",className:"text-sm font-medium text-gray-700",children:"fr"===i?"Trier par:":"Sort by:"}),(0,a.jsxs)("select",{id:"sort",value:"".concat(y.field,"-").concat(y.direction),onChange:e=>{let[r,t]=e.target.value.split("-");j({field:r,direction:t}),f(1)},className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"name-asc",children:"fr"===i?"Nom A-Z":"Name A-Z"}),(0,a.jsx)("option",{value:"name-desc",children:"fr"===i?"Nom Z-A":"Name Z-A"}),(0,a.jsx)("option",{value:"price-asc",children:"fr"===i?"Prix croissant":"Price Low-High"}),(0,a.jsx)("option",{value:"price-desc",children:"fr"===i?"Prix d\xe9croissant":"Price High-Low"}),(0,a.jsx)("option",{value:"vintage-desc",children:"fr"===i?"Mill\xe9sime r\xe9cent":"Newest Vintage"}),(0,a.jsx)("option",{value:"created_at-desc",children:"fr"===i?"Plus r\xe9cent":"Newest"})]})]})]}),(0,a.jsx)(l,{products:c,loading:d,error:m,itemsPerRow:3,className:"mb-8"}),k>1&&(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>f(e=>Math.max(1,e-1)),disabled:1===h,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"fr"===i?"Pr\xe9c\xe9dent":"Previous"}),Array.from({length:Math.min(5,k)},(e,r)=>{let t=Math.max(1,Math.min(k-4,h-2))+r;return(0,a.jsx)("button",{onClick:()=>f(t),className:"px-3 py-2 text-sm font-medium rounded-md ".concat(h===t?"text-white bg-purple-600 border border-purple-600":"text-gray-500 bg-white border border-gray-300 hover:bg-gray-50"),children:t},t)}),(0,a.jsx)("button",{onClick:()=>f(e=>Math.min(k,e+1)),disabled:h===k,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"fr"===i?"Suivant":"Next"})]})]})]})]})})}}},e=>{e.O(0,[5239,8441,1255,7358],()=>e(e.s=2696)),_N_E=e.O()}]);